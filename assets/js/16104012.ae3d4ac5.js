"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9400],{3905:function(t,e,n){n.d(e,{Zo:function(){return d},kt:function(){return p}});var a=n(7294);function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function i(t,e){if(null==t)return{};var n,a,s=function(t,e){if(null==t)return{};var n,a,s={},o=Object.keys(t);for(a=0;a<o.length;a++)n=o[a],e.indexOf(n)>=0||(s[n]=t[n]);return s}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)n=o[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}var r=a.createContext({}),c=function(t){var e=a.useContext(r),n=e;return t&&(n="function"==typeof t?t(e):l(l({},e),t)),n},d=function(t){var e=c(t.components);return a.createElement(r.Provider,{value:e},t.children)},u={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},h=a.forwardRef((function(t,e){var n=t.components,s=t.mdxType,o=t.originalType,r=t.parentName,d=i(t,["components","mdxType","originalType","parentName"]),h=c(n),p=s,m=h["".concat(r,".").concat(p)]||h[p]||u[p]||o;return n?a.createElement(m,l(l({ref:e},d),{},{components:n})):a.createElement(m,l({ref:e},d))}));function p(t,e){var n=arguments,s=e&&e.mdxType;if("string"==typeof t||s){var o=n.length,l=new Array(o);l[0]=h;var i={};for(var r in e)hasOwnProperty.call(e,r)&&(i[r]=e[r]);i.originalType=t,i.mdxType="string"==typeof t?t:s,l[1]=i;for(var c=2;c<o;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},2832:function(t,e,n){n.r(e),n.d(e,{frontMatter:function(){return i},contentTitle:function(){return r},metadata:function(){return c},toc:function(){return d},default:function(){return h}});var a=n(7462),s=n(3366),o=(n(7294),n(3905)),l=["components"],i={sidebar_position:2,title:"Load Tests"},r="Load Tests",c={unversionedId:"loadtests",id:"loadtests",title:"Load Tests",description:"To demonstrate the possible advantage of this PoC implementation in comparison to the Ruby implementation (cloudcontrollerng) we ran a few load tests to find out the limits of both implementations.",source:"@site/docs/loadtests.md",sourceDirName:".",slug:"/loadtests",permalink:"/go-cf-api/docs/loadtests",editUrl:"https://github.com/cloudfoundry/go-cf-api/edit/main/docs/docs/loadtests.md",tags:[],version:"current",lastUpdatedBy:"Florian Braun",lastUpdatedAt:1639471908,formattedLastUpdatedAt:"12/14/2021",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Load Tests"},sidebar:"tutorialSidebar",previous:{title:"Intro",permalink:"/go-cf-api/docs/intro"}},d=[{value:"Go vs Ruby implementation",id:"go-vs-ruby-implementation",children:[{value:"Test setup",id:"test-setup",children:[],level:3},{value:"/v3/info",id:"v3info",children:[{value:"Ruby Implementation",id:"ruby-implementation",children:[],level:5},{value:"Go Implementation",id:"go-implementation",children:[],level:5}],level:3},{value:"/v3/buildpacks",id:"v3buildpacks",children:[{value:"Ruby Implementation",id:"ruby-implementation-1",children:[],level:5},{value:"Go Implementation",id:"go-implementation-1",children:[],level:5}],level:3},{value:"/v3/security_groups/:guid",id:"v3security_groupsguid",children:[{value:"Ruby Implementation",id:"ruby-implementation-2",children:[],level:5},{value:"Go Implementation",id:"go-implementation-2",children:[],level:5}],level:3},{value:"VM Resources",id:"vm-resources",children:[{value:"Go Implementation",id:"go-implementation-3",children:[{value:"CPU Load",id:"cpu-load",children:[{value:"HAProxy CPU Load",id:"haproxy-cpu-load",children:[],level:6},{value:"Go CPU Load",id:"go-cpu-load",children:[],level:6}],level:5},{value:"RAM Usage",id:"ram-usage",children:[],level:5},{value:"TCP Connections",id:"tcp-connections",children:[],level:5},{value:"DB connections and transactions per second",id:"db-connections-and-transactions-per-second",children:[],level:5}],level:4},{value:"Ruby Implementation",id:"ruby-implementation-3",children:[{value:"CPU Load",id:"cpu-load-1",children:[{value:"Nginx Load",id:"nginx-load",children:[],level:6},{value:"CloudController Load",id:"cloudcontroller-load",children:[],level:6}],level:5},{value:"RAM Usage",id:"ram-usage-1",children:[],level:5},{value:"TCP Connections",id:"tcp-connections-1",children:[],level:5},{value:"DB connections and transactions per second",id:"db-connections-and-transactions-per-second-1",children:[],level:5}],level:4}],level:3},{value:"Summary",id:"summary",children:[],level:3},{value:"Raw Measurements",id:"raw-measurements",children:[],level:3}],level:2},{value:"Go - Test single db connection",id:"go---test-single-db-connection",children:[{value:"Test setup",id:"test-setup-1",children:[],level:3},{value:"/v3/info",id:"v3info-1",children:[],level:3},{value:"/v3/buildpacks",id:"v3buildpacks-1",children:[],level:3},{value:"/v3/security_groups/:guid",id:"v3security_groupsguid-1",children:[],level:3},{value:"VM Resources",id:"vm-resources-1",children:[{value:"DB connections and transactions per second",id:"db-connections-and-transactions-per-second-2",children:[],level:4}],level:3},{value:"Summary",id:"summary-1",children:[],level:3},{value:"Raw Measurements",id:"raw-measurements-1",children:[],level:3}],level:2},{value:"Viewing Raw Results",id:"viewing-raw-results",children:[{value:"Vegeta.log",id:"vegetalog",children:[],level:3},{value:"Netdata Snapshot",id:"netdata-snapshot",children:[],level:3},{value:"Binary Vegeta Files",id:"binary-vegeta-files",children:[],level:3},{value:"HTML Folder",id:"html-folder",children:[],level:3}],level:2}],u={toc:d};function h(t){var e=t.components,i=(0,s.Z)(t,l);return(0,o.kt)("wrapper",(0,a.Z)({},u,i,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"load-tests"},"Load Tests"),(0,o.kt)("p",null,"To demonstrate the possible advantage of this PoC implementation in comparison to the Ruby implementation (",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cloudfoundry/cloud_controller_ng"},"cloud_controller_ng"),") we ran a few load tests to find out the limits of both implementations."),(0,o.kt)("p",null,"The aim of this was to get an idea how much performance a new implementation could potentially offer by comparing select endpoints that we had already fully implemented in the new implementation.\nThe load test was conducted with ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tsenart/vegeta"},"vegeta")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/netdata/netdata"},"netdata")," to monitor VM and database resources."),(0,o.kt)("h2",{id:"go-vs-ruby-implementation"},"Go vs Ruby implementation"),(0,o.kt)("p",null,"We executed the same tests on both implementations on comparable hosting setups using the same database.\nThe following features were implemented for this comparison:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Logging"),(0,o.kt)("li",{parentName:"ul"},"Metrics (Prometheus)"),(0,o.kt)("li",{parentName:"ul"},"Rate Limiting (not enabled during tests)"),(0,o.kt)("li",{parentName:"ul"},"Authentication"),(0,o.kt)("li",{parentName:"ul"},"Authorization")),(0,o.kt)("p",null,"The tests then ran the same API call against specific endpoints with a variable number of requests per second.\nThese following endpoints where fully implemented in Go and compliant with ",(0,o.kt)("a",{parentName:"p",href:"https://v3-apidocs.cloudfoundry.org/version/3.109.0"},"CF V3 API 3.109.0"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://v3-apidocs.cloudfoundry.org/version/3.109.0/#info"},"/v3/info")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://v3-apidocs.cloudfoundry.org/version/3.109.0/#get-a-security-group"},"/v3/security_groups/:guid")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://v3-apidocs.cloudfoundry.org/version/3.109.0/#list-buildpacks"},"/v3/buildpacks"))),(0,o.kt)("h3",{id:"test-setup"},"Test setup"),(0,o.kt)("p",null,"The database was seeded with entries to have realistic database processing times as well as realistic result sets returned by Postgres. We ran these tests on a DB with:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"50 Spaces (ideally this number should have been higher but this was only noticed after the tests)"),(0,o.kt)("li",{parentName:"ul"},"1000 Orgs"),(0,o.kt)("li",{parentName:"ul"},"20 Buildpacks"),(0,o.kt)("li",{parentName:"ul"},"40000 Security Groups")),(0,o.kt)("p",null,"Other key setup facts:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The test was conducted on AWS"),(0,o.kt)("li",{parentName:"ul"},"We used ",(0,o.kt)("inlineCode",{parentName:"li"},"cloud_controller_ng")," version ",(0,o.kt)("inlineCode",{parentName:"li"},"3.108.0")," and the Go implementation version ",(0,o.kt)("inlineCode",{parentName:"li"},"0.0.19")),(0,o.kt)("li",{parentName:"ul"},"Both implementations were deployed as a single instance"),(0,o.kt)("li",{parentName:"ul"},"We executed these tests from a gorouter VM that had an instance type of ",(0,o.kt)("inlineCode",{parentName:"li"},"c4.8xlarge")),(0,o.kt)("li",{parentName:"ul"},"We skipped the Cloud Foundry routing layer by accessing the instances under test directly over the private network the gorouter is also part of"),(0,o.kt)("li",{parentName:"ul"},"Both the Go and Ruby implementations of the CloudController were deployed on a ",(0,o.kt)("inlineCode",{parentName:"li"},"t3a.xlarge")," instance"),(0,o.kt)("li",{parentName:"ul"},"Postgres database used was intentionally oversized to a ",(0,o.kt)("inlineCode",{parentName:"li"},"db.m5.2xlarge")," instance to prevent the DB being a bottleneck"),(0,o.kt)("li",{parentName:"ul"},"The maximum amount of concurrently usable DB connections for both implementations was set to ",(0,o.kt)("inlineCode",{parentName:"li"},"500")),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"threadpool_size")," config parameter in ",(0,o.kt)("inlineCode",{parentName:"li"},"cloud_controller_ng")," was set to ",(0,o.kt)("inlineCode",{parentName:"li"},"1000")," to theoretically make the maximum possible parallelism more even between the implementations (although we know Ruby is single threaded)"),(0,o.kt)("li",{parentName:"ul"},"The test was conducted with an admin user and rate limiting was not enabled on either implementation")),(0,o.kt)("h3",{id:"v3info"},"/v3/info"),(0,o.kt)("p",null,"The load test of the ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/info")," endpoint was designed to indicate the maximum number of requests the web server for each implementation can handle, excluding expensive business logic, authentication or external systems (e.g. database). It represents the raw theoretical throughput the underlying technology stack can serve."),(0,o.kt)("h5",{id:"ruby-implementation"},"Ruby Implementation"),(0,o.kt)("p",null,"For the Ruby implementation, whilst 64 requests per second on the ",(0,o.kt)("inlineCode",{parentName:"p"},"v3/info")," endpoint ran without issues, the instance broke down at 128 requests per second.\n",(0,o.kt)("img",{src:n(9174).Z}),"\nInterestingly, from the first second onward, we observed API error responses that were also slow (13 seconds). In addition, the time it takes for these errors to return decreases linearly until it matches the response times of successful calls.\nOnly 30% of the requests are served correctly, which is even lower then the previously achieved 64 requests per second.\nThe error codes are ",(0,o.kt)("inlineCode",{parentName:"p"},"502 Bad Gatewaty")," so the behaviour we have previously observed in outages of ",(0,o.kt)("inlineCode",{parentName:"p"},"cloud_controller_ng")," was reproduced in these tests. Most likely the ",(0,o.kt)("inlineCode",{parentName:"p"},"cloud_controller_ng")," web process did not answer its own health endpoint (in time) and so ",(0,o.kt)("inlineCode",{parentName:"p"},"nginx")," considered the backend unhealthy and a ",(0,o.kt)("inlineCode",{parentName:"p"},"502")," was served. Interestingly enough we also see ",(0,o.kt)("inlineCode",{parentName:"p"},"500 Internal Server Error")," responses which should not happen as this means unhandled exceptions in the code.\nSomewhere around 100 requests per second is the estimated hard limit of requests per second for any endpoint as ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/info")," should be one of the least expensive."),(0,o.kt)("p",null,"In the ",(0,o.kt)("a",{parentName:"p",href:"#cpu-load-1"},"VM Resources Section"),", at 128 requests per second, the API is not limited by system resources. However ",(0,o.kt)("a",{parentName:"p",href:"#cloudcontroller-load"},"Cloud Controller Load")," shows a usage of 25% which means a full core. This is the expected hard limit of Ruby as the Ruby interpreter runs in a single thread."),(0,o.kt)("h5",{id:"go-implementation"},"Go Implementation"),(0,o.kt)("p",null,"Initially it was thought that 4k requests per second would be more than the maximum for a 4 core VM so tests were only conducted up to this rate. The Go implementation appeared to be able to handle this load.\n",(0,o.kt)("img",{src:n(308).Z})),(0,o.kt)("p",null,"In the ",(0,o.kt)("a",{parentName:"p",href:"#vm-resources"},"VM Resources Section")," at 4096 requests per second, the API is fully utilising all CPU resources and so is likely limited by CPU. In high load situations, the HAProxy process also seems to consume a lot of CPU. In this case HAProxy consumed 2.5 Cores while the Go process consumed roughly 1 core."),(0,o.kt)("h3",{id:"v3buildpacks"},"/v3/buildpacks"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/buildpacks")," endpoint is an endpoint that requires no role checking but does require authentication and performs relatively simple SQL queries on a single table. This test is intended to show the maximum load of a simple list endpoint for both implementations."),(0,o.kt)("h5",{id:"ruby-implementation-1"},"Ruby Implementation"),(0,o.kt)("p",null,"For the Ruby implementation we saw that at a rate of 32 requests per seconds generally works but with a throughput of only 27 requests per second, whilst the test at 64 requests per second causes the instance to fail with the same behaviour as seen in the ",(0,o.kt)("a",{parentName:"p",href:"#v3info"},"/v3/info")," test."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(9498).Z}),"\n",(0,o.kt)("img",{src:n(8506).Z})),(0,o.kt)("p",null,"So the estimated maximum would be around 30 requests per second since in the ",(0,o.kt)("a",{parentName:"p",href:"#cpu-load-1"},"VM Resources Section")," we see no overall resource limitation rather the Ruby thread using its full single core already at 32 requests per second. Additionally the throughput of 27 tells us that a backlog of requests is starting to build up already."),(0,o.kt)("h5",{id:"go-implementation-1"},"Go Implementation"),(0,o.kt)("p",null,"For the Go implementation, we see some requests timing out on the client side (30s timeout) at around 1k requests per second.\n",(0,o.kt)("img",{src:n(1313).Z}),"\nIt is possible that these requests would still have been served eventually but the default timeout for the test client defines that every request longer than 30 seconds counts as failed.\nIt appears that somewhere around 550 requests per second is upper limit for this endpoint as this was roughly the average throughput."),(0,o.kt)("h3",{id:"v3security_groupsguid"},"/v3/security_groups/:guid"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/security_groups/:guid")," endpoint involves checking of roles and also has links to spaces via multiple SQL joins. It has more complex queries and also through the high number of security_groups in the database, we can test how the implementations can cope with  higher processing times in the DB. Ideally we would have liked to test the list security_groups endpoint but that was not yet implemented in Go at the time these tests were conducted."),(0,o.kt)("h5",{id:"ruby-implementation-2"},"Ruby Implementation"),(0,o.kt)("p",null,"For the Ruby implementation we saw, again, that a rate of 64 requests per second overloads the ",(0,o.kt)("inlineCode",{parentName:"p"},"cloud_controller_ng")," due to the Ruby process using the entire single thread it has access to."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(2062).Z})),(0,o.kt)("p",null,"However, this time the throughput during the test at 32 requests per second was the full 32 requests per second so it seems the ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/security_groups/:guid")," is a bit cheaper on the CPU. Although the single Ruby thread does appear to already be exhausted at this rate so the estimated sustainable throughput is around 40 requests per second."),(0,o.kt)("h5",{id:"go-implementation-2"},"Go Implementation"),(0,o.kt)("p",null,"For the ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/security_groups/:guid")," endpoint we also see a limit of around 1k requests per second. This does seem like a slight improvement over ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/buildpacks")," as at 1k requests, all requests were served within the 30s timeout limit."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(2978).Z})),(0,o.kt)("p",null,"Based on the throughput numbers, a sustained load of 750 requests per second seems realistic."),(0,o.kt)("p",null,"A interesting behaviour in comparison to ",(0,o.kt)("inlineCode",{parentName:"p"},"cloud_controller_ng")," can be seen at a rate of 2k requests per second.\nThe response times rise for nearly 20 seconds until all requests run into a timeout. Yet no server error was visible - just a large increase in latencies.\n",(0,o.kt)("img",{src:n(1173).Z})),(0,o.kt)("h3",{id:"vm-resources"},"VM Resources"),(0,o.kt)("p",null,"Here are the recordings of the system resources while executing the test. The full data is available as netdata dump in the ",(0,o.kt)("a",{parentName:"p",href:"#raw-measurements"},"raw results tarball archive"),"."),(0,o.kt)("h4",{id:"go-implementation-3"},"Go Implementation"),(0,o.kt)("p",null,"To correlate the metrics to specific test runs, here are the timestamps of the test runs:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'Targeting: https://10.0.65.75/v3/info\n2021-11-03 08:56:07.314080 - Using attack rate: 8 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 08:56:57.638468 - Using attack rate: 16 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 08:57:47.913230 - Using attack rate: 24 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 08:58:38.179441 - Using attack rate: 32 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 08:59:28.498043 - Using attack rate: 64 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 09:00:18.947272 - Using attack rate: 128 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 09:01:09.172216 - Using attack rate: 256 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 09:01:59.411845 - Using attack rate: 512 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 09:02:49.780627 - Using attack rate: 1024 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 09:03:40.089794 - Using attack rate: 2048 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 09:04:30.480274 - Using attack rate: 4096 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n\n\nTargeting: https://10.0.65.75/v3/buildpacks\n2021-11-03 09:05:40.888477 - Using attack rate: 8 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n2021-11-03 09:06:31.237477 - Using attack rate: 16 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n2021-11-03 09:07:21.503889 - Using attack rate: 24 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n2021-11-03 09:08:11.840010 - Using attack rate: 32 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n2021-11-03 09:09:02.160462 - Using attack rate: 64 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n2021-11-03 09:09:52.466723 - Using attack rate: 128 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n2021-11-03 09:10:42.759395 - Using attack rate: 256 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n2021-11-03 09:11:33.273219 - Using attack rate: 512 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n2021-11-03 09:12:23.564614 - Using attack rate: 1024 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n2021-11-03 09:13:38.855490 - Using attack rate: 2048 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n2021-11-03 09:14:59.447755 - Using attack rate: 4096 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/buildpacks"}\n\n\nTargeting: https://10.0.65.75/v3/security_groups\n2021-11-03 09:16:20.424447 - Using attack rate: 8 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-03 09:17:10.786576 - Using attack rate: 16 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-03 09:18:01.054648 - Using attack rate: 24 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-03 09:18:51.309282 - Using attack rate: 32 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-03 09:19:41.730875 - Using attack rate: 64 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-03 09:20:32.027494 - Using attack rate: 128 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-03 09:21:22.264486 - Using attack rate: 256 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-03 09:22:12.736188 - Using attack rate: 512 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-03 09:23:03.124116 - Using attack rate: 1024 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-03 09:24:04.777251 - Using attack rate: 2048 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-03 09:25:25.160157 - Using attack rate: 4096 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n')),(0,o.kt)("h5",{id:"cpu-load"},"CPU Load"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(450).Z}),"\nCPU is fully used, although a syslog process (blackbox) always failed and went out of control in the middle of the tests and consumed a full core consistently but with a high nice value so it is not thought to have influenced the test. Only a system reboot helped to resolve the broken blackbox process as it will restart once killed and get stuck again."),(0,o.kt)("h6",{id:"haproxy-cpu-load"},"HAProxy CPU Load"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(5217).Z})),(0,o.kt)("p",null,"At high number of requests or error rates, the load of the HAProxy process is quite substantial. There may be optimizations in HAProxy config possible here to improve overall performance of the API since it appears to be CPU limited. If less CPU were to be consumed by HAProxy in a high load scenario, this may free up CPU to increase the throughput of the Go process."),(0,o.kt)("h6",{id:"go-cpu-load"},"Go CPU Load"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(3608).Z}),"\nAt maximum, only 1-1.5 Cores are used. At high load HAProxy consumes the rest so 1.5-3 Cores."),(0,o.kt)("h5",{id:"ram-usage"},"RAM Usage"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(7723).Z})),(0,o.kt)("h5",{id:"tcp-connections"},"TCP Connections"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(7288).Z})),(0,o.kt)("h5",{id:"db-connections-and-transactions-per-second"},"DB connections and transactions per second"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(4778).Z}),"\nThe DB connection pool is scaled up and down on demand. At maximum we observed around 5k transactions/s on the database. A more realistic peak load that is reached more consistently is around 3k-3.5k requests/s. As the Go implementation is designed to be the bottleneck and not the database, the transactions per second is not the maximum achievable for a single instance."),(0,o.kt)("p",null,"For this we conducted a ",(0,o.kt)("a",{parentName:"p",href:"#go---test-single-db-connection"},"second test")," with a single DB connection to get a estimate for how many API requests we could serve with the currently limiting factor of 5k available DB connections on AWS RDS PostgreSQL instances, provided that it can handle all of the transactions."),(0,o.kt)("h4",{id:"ruby-implementation-3"},"Ruby Implementation"),(0,o.kt)("p",null,"To correlate the metrics to specific test runs, here are the timestamps of the test runs:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'Targeting: https://10.0.65.66:9024/v3/info\n2021-11-02 14:49:37.770203 - Using attack rate: 8 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n2021-11-02 14:50:28.070121 - Using attack rate: 16 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n2021-11-02 14:51:18.421874 - Using attack rate: 24 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n2021-11-02 14:52:08.730871 - Using attack rate: 32 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n2021-11-02 14:52:58.972751 - Using attack rate: 64 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n2021-11-02 14:53:49.302106 - Using attack rate: 128 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n2021-11-02 14:54:45.049050 - Using attack rate: 256 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n2021-11-02 14:55:39.396009 - Using attack rate: 512 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n2021-11-02 14:56:35.547554 - Using attack rate: 1024 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n2021-11-02 14:57:25.914571 - Using attack rate: 2048 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n2021-11-02 14:58:19.378228 - Using attack rate: 4096 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/info"}\n\n\nTargeting: https://10.0.65.66:9024/v3/buildpacks\n2021-11-02 14:59:17.465476 - Using attack rate: 8 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n2021-11-02 15:00:07.879977 - Using attack rate: 16 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n2021-11-02 15:00:58.330487 - Using attack rate: 24 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n2021-11-02 15:01:48.664109 - Using attack rate: 32 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n2021-11-02 15:02:45.669107 - Using attack rate: 64 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n2021-11-02 15:03:42.210203 - Using attack rate: 128 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n2021-11-02 15:04:51.524479 - Using attack rate: 256 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n2021-11-02 15:05:42.108656 - Using attack rate: 512 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n2021-11-02 15:07:12.638379 - Using attack rate: 1024 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n2021-11-02 15:09:04.571407 - Using attack rate: 2048 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n2021-11-02 15:10:19.833107 - Using attack rate: 4096 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/buildpacks"}\n\n\nTargeting: https://10.0.65.66:9024/v3/security_groups\n2021-11-02 15:11:33.580214 - Using attack rate: 8 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-02 15:12:24.311953 - Using attack rate: 16 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-02 15:13:14.636080 - Using attack rate: 24 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-02 15:14:05.095217 - Using attack rate: 32 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-02 15:14:55.409231 - Using attack rate: 64 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-02 15:15:55.436128 - Using attack rate: 128 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-02 15:16:57.788453 - Using attack rate: 256 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-02 15:17:54.845722 - Using attack rate: 512 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-02 15:19:05.253594 - Using attack rate: 1024 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-02 15:20:11.579831 - Using attack rate: 2048 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n2021-11-02 15:21:24.921151 - Using attack rate: 4096 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.66:9024/v3/security_groups/619fb6a8-038c-4934-9285-1c2793cb3b1c"}\n')),(0,o.kt)("h5",{id:"cpu-load-1"},"CPU Load"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(4634).Z}),"\nThe CPU load is a lot more spiky and even when the API responds with failures, not all resources are used."),(0,o.kt)("h6",{id:"nginx-load"},"Nginx Load"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(3828).Z}),"\nAt high loads nginx consumes a full core which is still a lot less than HAproxy did."),(0,o.kt)("h6",{id:"cloudcontroller-load"},"CloudController Load"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(8546).Z}),"\nIn this graph it is clear that the real resource limitation is Ruby's single threaded interpreter. Using a full core is the limit of a single Ruby process and once hit the API responds with failures or fails to answer requests."),(0,o.kt)("h5",{id:"ram-usage-1"},"RAM Usage"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(5260).Z})),(0,o.kt)("h5",{id:"tcp-connections-1"},"TCP Connections"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(8551).Z})),(0,o.kt)("h5",{id:"db-connections-and-transactions-per-second-1"},"DB connections and transactions per second"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(5286).Z}),"\nThe DB connection pool is only ever scaled up and never down again. Connections would get closed once they time out after an hour but this was beyond the limit of these tests. At maximum we observed around 450 transactions/s on the database, whilst a more realistic peak load that is reached more consistently is around 300-350 requests/s."),(0,o.kt)("h3",{id:"summary"},"Summary"),(0,o.kt)("p",null,"Maximum requests per second on this test setup"),(0,o.kt)("table",null,(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",{align:"center"},"Endpoint"),(0,o.kt)("td",{align:"center"},"Go Implementation"),(0,o.kt)("td",{align:"center"},"Ruby Implementation"),(0,o.kt)("td",{align:"center"},"Improvement")),(0,o.kt)("tr",null,(0,o.kt)("td",{align:"center"},"/v3/info"),(0,o.kt)("td",{align:"center"},"4000"),(0,o.kt)("td",{align:"center"},"100"),(0,o.kt)("td",{align:"center"},"+3900%(40 Times more)")),(0,o.kt)("tr",null,(0,o.kt)("td",{align:"center"},"/v3/buildpacks"),(0,o.kt)("td",{align:"center"},"550"),(0,o.kt)("td",{align:"center"},"30"),(0,o.kt)("td",{align:"center"},"+1730%(18.3 Times more)")),(0,o.kt)("tr",null,(0,o.kt)("td",{align:"center"},"/v3/security_groups/:guid"),(0,o.kt)("td",{align:"center"},"750"),(0,o.kt)("td",{align:"center"},"40"),(0,o.kt)("td",{align:"center"},"+1775%(18.75 Times more)")))),(0,o.kt)("p",null,"Further Findings"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The Go implementation can issue 10x more transactions per second (operations on the database) using the same number of DB connections. Potentially, this number could be even higher but given the Go implementation performs fewer DB transactions per API request, this would likely become CPU bound before being limited by DB connections. The Ruby implementation on the other hand has also some room for improvement that could be made e.g. by improving how role checking is done as this could be performed with fewer queries. This test only serves to compare the current state."),(0,o.kt)("li",{parentName:"ul"},"The Go implementation does not get pulled out of load balancing in an overload situation"),(0,o.kt)("li",{parentName:"ul"},"The Go implementation may be wasting a lot of resources in HAProxy that could be looked at and tweaked or behaviour (TLS termination etc.) moved directly into the Go codebase"),(0,o.kt)("li",{parentName:"ul"},"The Go implementation uses more RAM in general and it increases/decreases more on peak loads, but this is to be expected since it handles up to 40 times more requests")),(0,o.kt)("p",null,"We also briefly tested the Go implementation on a large VM (64 cores) to see how it would scale vertically. We saw 30k+ ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/info")," calls per second being handled by a single instance. At that point the emitter of the requests could no longer keep up and a distributed load test would be needed to see real results.\nSince this would be time consuming and not comparable against a single threaded implementation we did not pursue this test further."),(0,o.kt)("h3",{id:"raw-measurements"},"Raw Measurements"),(0,o.kt)("p",null,"All measurement runs can be found in below table. At the bottom of each column is a download link for all raw measurements in a tar.xz file.\nA guide for looking at the raw values is can be found in ",(0,o.kt)("a",{parentName:"p",href:"#viewing-raw-results"},"viewing raw results")),(0,o.kt)("table",null,(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",{align:"center"},"Go Implementation"),(0,o.kt)("td",{align:"center"},"Ruby Implementation")),(0,o.kt)("tr",null,(0,o.kt)("td",{align:"center"},"GET /v3/info",(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_8.html"},"v3/info - 8 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_16.html"},"v3/info - 16 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_24.html"},"v3/info - 24 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_32.html"},"v3/info - 32 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_64.html"},"v3/info - 64 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_128.html"},"v3/info - 128 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_256.html"},"v3/info - 256 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_512.html"},"v3/info - 512 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_1024.html"},"v3/info - 1024 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_2048.html"},"v3/info - 2048 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-info_4096.html"},"v3/info - 4096 req/s")," ")),"GET /v3/buildpacks",(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_8.html"},"v3/buildpacks - 8 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_16.html"},"v3/buildpacks - 16 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_24.html"},"v3/buildpacks - 24 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_32.html"},"v3/buildpacks - 32 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_64.html"},"v3/buildpacks - 64 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_128.html"},"v3/buildpacks - 128 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_256.html"},"v3/buildpacks - 256 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_512.html"},"v3/buildpacks - 512 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_1024.html"},"v3/buildpacks - 1024 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_2048.html"},"v3/buildpacks - 2048 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-buildpacks_4096.html"},"v3/buildpacks - 4096 req/s")," ")),"GET /v3/security_groups/:guid",(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_8.html"},"v3/security_groups - 8 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_16.html"},"v3/security_groups - 16 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_24.html"},"v3/security_groups - 24 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_32.html"},"v3/security_groups - 32 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_64.html"},"v3/security_groups - 64 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_128.html"},"v3/security_groups - 128 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_256.html"},"v3/security_groups - 256 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_512.html"},"v3/security_groups - 512 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_1024.html"},"v3/security_groups - 1024 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_2048.html"},"v3/security_groups - 2048 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/html/v3-security_groups_4096.html"},"v3/security_groups - 4096 req/s")," "))),(0,o.kt)("td",{align:"center"},"GET /v3/info",(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_8.html"},"v3/info - 8 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_16.html"},"v3/info - 16 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_24.html"},"v3/info - 24 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_32.html"},"v3/info - 32 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_64.html"},"v3/info - 64 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_128.html"},"v3/info - 128 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_256.html"},"v3/info - 256 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_512.html"},"v3/info - 512 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_1024.html"},"v3/info - 1024 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_2048.html"},"v3/info - 2048 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-info_4096.html"},"v3/info - 4096 req/s")," ")),"GET /v3/buildpacks",(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_8.html"},"v3/buildpacks - 8 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_16.html"},"v3/buildpacks - 16 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_24.html"},"v3/buildpacks - 24 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_32.html"},"v3/buildpacks - 32 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_64.html"},"v3/buildpacks - 64 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_128.html"},"v3/buildpacks - 128 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_256.html"},"v3/buildpacks - 256 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_512.html"},"v3/buildpacks - 512 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_1024.html"},"v3/buildpacks - 1024 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_2048.html"},"v3/buildpacks - 2048 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-buildpacks_4096.html"},"v3/buildpacks - 4096 req/s")," ")),"GET /v3/security_groups/:guid",(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_8.html"},"v3/security_groups - 8 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_16.html"},"v3/security_groups - 16 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_24.html"},"v3/security_groups - 24 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_32.html"},"v3/security_groups - 32 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_64.html"},"v3/security_groups - 64 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_128.html"},"v3/security_groups - 128 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_256.html"},"v3/security_groups - 256 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_512.html"},"v3/security_groups - 512 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_1024.html"},"v3/security_groups - 1024 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_2048.html"},"v3/security_groups - 2048 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/html/v3-security_groups_4096.html"},"v3/security_groups - 4096 req/s")," ")))),(0,o.kt)("tr",null,(0,o.kt)("td",{align:"center"},(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test/cc_go_load_test.tar.xz"},"Raw Archive")),(0,o.kt)("td",{align:"center"},(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_ng_load_test/cc_ng_load_test.tar.xz"},"Raw Archive"))))),(0,o.kt)("h2",{id:"go---test-single-db-connection"},"Go - Test single db connection"),(0,o.kt)("p",null,"This second test is not aimed at comparing against the ",(0,o.kt)("inlineCode",{parentName:"p"},"cloud_controller_ng")," Ruby implementation - instead it is meant to show how many transactions can be issued to the database over a single connection.\nThis is important as currently a hard limit is set for e.g. AWS RDS instances. The biggest RDS instance can handle just ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_Limits.html#RDS_Limits.MaxConnections"},"5k open connections")," ",(0,o.kt)("inlineCode",{parentName:"p"},"LEAST({DBInstanceClassMemory/9531392}, 5000)"),"."),(0,o.kt)("p",null,"So when doing e.g. 30 ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/buildpacks")," requests per second over 190 ",(0,o.kt)("inlineCode",{parentName:"p"},"cloud_controller_ng")," instances (maximum number of instances on 5000 DB connections using the default DB connection pool) we can just squeeze out 5.7k requests per second under absolutely optimal conditions (the DB responding as if it was not under load). This is currently a limiting factor for horizontally scaling ",(0,o.kt)("inlineCode",{parentName:"p"},"cloud_controller_ng"),". In reality we already see issues around 800-1000 requests per second arising when using 150 ",(0,o.kt)("inlineCode",{parentName:"p"},"cloud_controller_ng")," instances (based on real load distribution with a large production databases)."),(0,o.kt)("p",null,"With this test we aim to see how many requests per second and DB transactions could theoretically be served by the Go implementation with 5000 connections and if this number is still a hard limit for the horizontal scaling of the Go implementation."),(0,o.kt)("h3",{id:"test-setup-1"},"Test setup"),(0,o.kt)("p",null,"The setup was the same as in the ",(0,o.kt)("a",{parentName:"p",href:"#test-setup"},"first test run"),".\nHowever the the maximum amount of usable DB connections was set to ",(0,o.kt)("inlineCode",{parentName:"p"},"1"),".\nAdditionally just the Go implementation was tested."),(0,o.kt)("h3",{id:"v3info-1"},"/v3/info"),(0,o.kt)("p",null,"With a single DB Connection, the performance of the ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/info")," is expected to be unchanged from the first test.\nHowever, we observe fewer requests per second were handled - this is likely related to VM burst budgets.\nIdeally these tests should have been conducted on non-burstable instance types and these may be repeated later but for now they are kept as they are to serve as at least a rough comparison."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(3679).Z})),(0,o.kt)("h3",{id:"v3buildpacks-1"},"/v3/buildpacks"),(0,o.kt)("p",null,"The buildpacks endpoint can now only handle around 250 requests per second which produces roughly 1k transactions per second on the database.\nThis indicates that the single DB connection is being fully utilised and has become the bottleneck."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(4496).Z})),(0,o.kt)("p",null,"At 512 requests per second the Go implementation is overloaded in a way that API calls take longer and longer until eventually the 30 second timeout of test client cancels the request and marks it as error for the particularly slow requests (around 50%)."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(5464).Z})),(0,o.kt)("h3",{id:"v3security_groupsguid-1"},"/v3/security_groups/:guid"),(0,o.kt)("p",null,"The security_groups endpoint can now only handle around 320 requests per second which produce roughly 1k transactions per second on the database also.\nThis endpoint is thus a bit cheaper than ",(0,o.kt)("inlineCode",{parentName:"p"},"v3/buildpacks")," since it issues fewer or cheaper database statements."),(0,o.kt)("p",null,"The test at 256 requests per second was successful.\n",(0,o.kt)("img",{src:n(2724).Z}),"\nIt struggled a bit with 512 requests per second, managing only around 320 requests per second.\n",(0,o.kt)("img",{src:n(4076).Z}),"\nSince the 1k transactions per second seems to stay the same in comparison to the ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/buildpacks")," endpoint, we expect this number to be a realistic limit for a single DB connection."),(0,o.kt)("h3",{id:"vm-resources-1"},"VM Resources"),(0,o.kt)("p",null,"Metric values were essentially the same between this run and the one with unlimited DB connections.\nThe exception being DB connections and transactions per second of course."),(0,o.kt)("h4",{id:"db-connections-and-transactions-per-second-2"},"DB connections and transactions per second"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(984).Z}),"\nThe DB connections show around 30 connections because another ",(0,o.kt)("inlineCode",{parentName:"p"},"cloud_controller_ng")," instance is connected at the same time but without any load."),(0,o.kt)("h3",{id:"summary-1"},"Summary"),(0,o.kt)("p",null,"We estimate the Go implementation can serve around 1k transactions on a single DB connection when not being limited by CPU but instead the DB connection. As 1k DB transactions correlate to 320 ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/security_groups/:guid")," calls and 250 ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/buildpacks")," calls, it could theoretically handle ",(0,o.kt)("inlineCode",{parentName:"p"},"320req/s * 5000 connections = 1600000")," so 1.6 million requests per second over 5k DB connections for ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/security_groups/:guid"),". This probably won't actually be achievable since the DB could never handle this many transactions (",(0,o.kt)("inlineCode",{parentName:"p"},"1000 transactions per second * 5k connections = 5 million"),"). However this does indicate that for the Go implementation, the number of DB connections should not be a limit anymore - rather the VM and DB performance."),(0,o.kt)("h3",{id:"raw-measurements-1"},"Raw Measurements"),(0,o.kt)("p",null,"All results can be found in below table."),(0,o.kt)("table",null,(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",{align:"center"},"Go Implementation")),(0,o.kt)("tr",null,(0,o.kt)("td",{align:"center"},"GET /v3/info",(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_8.html"},"v3/info - 8 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_16.html"},"v3/info - 16 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_24.html"},"v3/info - 24 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_32.html"},"v3/info - 32 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_64.html"},"v3/info - 64 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_128.html"},"v3/info - 128 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_256.html"},"v3/info - 256 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_512.html"},"v3/info - 512 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_1024.html"},"v3/info - 1024 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_2048.html"},"v3/info - 2048 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-info_4096.html"},"v3/info - 4096 req/s")," ")),"GET /v3/buildpacks",(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_8.html"},"v3/buildpacks - 8 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_16.html"},"v3/buildpacks - 16 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_24.html"},"v3/buildpacks - 24 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_32.html"},"v3/buildpacks - 32 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_64.html"},"v3/buildpacks - 64 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_128.html"},"v3/buildpacks - 128 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_256.html"},"v3/buildpacks - 256 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_512.html"},"v3/buildpacks - 512 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_1024.html"},"v3/buildpacks - 1024 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_2048.html"},"v3/buildpacks - 2048 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-buildpacks_4096.html"},"v3/buildpacks - 4096 req/s")," ")),"GET /v3/security_groups/:guid",(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_8.html"},"v3/security_groups - 8 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_16.html"},"v3/security_groups - 16 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_24.html"},"v3/security_groups - 24 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_32.html"},"v3/security_groups - 32 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_64.html"},"v3/security_groups - 64 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_128.html"},"v3/security_groups - 128 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_256.html"},"v3/security_groups - 256 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_512.html"},"v3/security_groups - 512 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_1024.html"},"v3/security_groups - 1024 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_2048.html"},"v3/security_groups - 2048 req/s")," "),(0,o.kt)("li",null,(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/html/v3-security_groups_4096.html"},"v3/security_groups - 4096 req/s")," ")))),(0,o.kt)("tr",null,(0,o.kt)("td",{align:"center"},(0,o.kt)("a",{target:"_parent",href:"/loadtests/v1/cc_go_load_test_single_db_connection/cc_go_load_test_single_db_connection.tar.xz"},"Raw Archive"))))),(0,o.kt)("h2",{id:"viewing-raw-results"},"Viewing Raw Results"),(0,o.kt)("p",null,"The the raw measurements tarballs linked above include:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"vegeta.log")," Terminal output as text file (",(0,o.kt)("a",{parentName:"li",href:"#vegetalog"},"#vegetalog"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"netdata.snapshot")," VM and database metrics during run as ",(0,o.kt)("a",{parentName:"li",href:"https://learn.netdata.cloud/docs/dashboard/import-export-print-snapshot"},"netdata snapshot")," (",(0,o.kt)("a",{parentName:"li",href:"#netdata-snapshot"},"#netdata-snapshot"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"v3-.*_[0-9]*.bin")," Binary ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/tsenart/vegeta"},"vegeta")," files (",(0,o.kt)("a",{parentName:"li",href:"#binary-vegeta-files"},"#binary-vegeta-files"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"html folder")," Pre-rendered analysis from the binary files (",(0,o.kt)("a",{parentName:"li",href:"#html-folder"},"#html-folder"),")")),(0,o.kt)("h3",{id:"vegetalog"},"Vegeta.log"),(0,o.kt)("p",null,"A text file with (UTC) timestamps when the runs where executed. You can use these timestamps to correlate metrics from the netdata snapshot to individual runs."),(0,o.kt)("p",null,"Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'...\nTargeting: https://10.0.65.75/v3/info\n2021-11-03 07:56:07.314080 - Using attack rate: 8 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 07:56:57.638468 - Using attack rate: 16 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n2021-11-03 07:57:47.913230 - Using attack rate: 24 - {"body": "", "header": {"Authorization": "REDACTED"}, "method": "GET", "url": "https://10.0.65.75/v3/info"}\n...\n')),(0,o.kt)("h3",{id:"netdata-snapshot"},"Netdata Snapshot"),(0,o.kt)("p",null,"Netdata is a system monitoring tool one can ",(0,o.kt)("a",{parentName:"p",href:"https://learn.netdata.cloud/docs/agent/packaging/docker"},"start as a container locally"),".\nYou can then view the tool at http://localhost:9090.\nIt will monitor your local machine, but you can ",(0,o.kt)("a",{parentName:"p",href:"https://learn.netdata.cloud/docs/dashboard/import-export-print-snapshot"},"import a previously made recording"),".\n",(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/1153921/114218399-360fb600-991e-11eb-8dea-fabd2bffc5b3.gif",alt:null}),"\nThe file to use is ",(0,o.kt)("inlineCode",{parentName:"p"},"netdata.snapshot")," inside the raw results archive."),(0,o.kt)("h3",{id:"binary-vegeta-files"},"Binary Vegeta Files"),(0,o.kt)("p",null,"The results archive also includes raw binary dumps of ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tsenart/vegeta"},"vegeta"),".\nThe files have the ",(0,o.kt)("inlineCode",{parentName:"p"},".bin")," file ending. The name represents the tested endpoint as well as the load(requests per second)."),(0,o.kt)("p",null,"E.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"v3-buildpacks_32.bin")," is a test of the ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/buildpacks")," endpoint with ",(0,o.kt)("inlineCode",{parentName:"p"},"32 requests per second"),"."),(0,o.kt)("p",null,"These files can be piped to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tsenart/vegeta"},"vegeta")," for plotting and analysis. See: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tsenart/vegeta#report-command"},"https://github.com/tsenart/vegeta#report-command")),(0,o.kt)("h3",{id:"html-folder"},"HTML Folder"),(0,o.kt)("p",null,"The HTML folder includes the output of ",(0,o.kt)("inlineCode",{parentName:"p"},"vegeta report")," as well as ",(0,o.kt)("inlineCode",{parentName:"p"},"vegeta plot")," commands combined into one HTML page that can be viewed in your browser."))}h.isMDXComponent=!0},4778:function(t,e,n){e.Z=n.p+"assets/images/go_db_transactions-6413aad3c5ac33878f7d3a954f16faa5.png"},3608:function(t,e,n){e.Z=n.p+"assets/images/go_go_usage-3c2b3aceacefb55d35f948bf9d95d0f9.png"},5217:function(t,e,n){e.Z=n.p+"assets/images/go_haproxy_usage-484f2484e359763866940b1827b710c9.png"},450:function(t,e,n){e.Z=n.p+"assets/images/go_overall_cpu-e5b1d451eaa2fc93bacfd770d6b2fea6.png"},7723:function(t,e,n){e.Z=n.p+"assets/images/go_ram_usage-64b7b512e4ad0297af7cbda52af55486.png"},7288:function(t,e,n){e.Z=n.p+"assets/images/go_tcp_connections-430dd09eddf123962ce007d7e690ec6d.png"},984:function(t,e,n){e.Z=n.p+"assets/images/gosingle_db_transactions-0759f88f3f5abb2a89280301f5c144ee.png"},5286:function(t,e,n){e.Z=n.p+"assets/images/ng_db_transactions-a85940d4262436ccaa9b24d99782c541.png"},8546:function(t,e,n){e.Z=n.p+"assets/images/ng_ng_cpu-6cfd536e3a484f8f55f97f578d807dbb.png"},3828:function(t,e,n){e.Z=n.p+"assets/images/ng_nginx_cpu-fb34555f684add45ff653a4834a223e3.png"},4634:function(t,e,n){e.Z=n.p+"assets/images/ng_overall_cpu-79565fc055cc7e65914a6fec9d2b8c61.png"},5260:function(t,e,n){e.Z=n.p+"assets/images/ng_ram-65120b735b421ab258d8148bec020c77.png"},8551:function(t,e,n){e.Z=n.p+"assets/images/ng_tcp_connections-9b55c920af27644485ce8674c1aec653.png"},1313:function(t,e,n){e.Z=n.p+"assets/images/go_buildpacks_1024-5cfc9f8786d53f1ccd169127ead5ccc7.png"},308:function(t,e,n){e.Z=n.p+"assets/images/go_info_4096-9fdcaeec6b5b7196f50edcdfd2528dca.png"},2978:function(t,e,n){e.Z=n.p+"assets/images/go_security_groups_1024-ef7be64b2e496d5d8de29c1091451c20.png"},1173:function(t,e,n){e.Z=n.p+"assets/images/go_security_groups_2048-61e3dd1a12c1a7908e7d9094f52a304c.png"},4496:function(t,e,n){e.Z=n.p+"assets/images/gosingle_buildpacks_256-5f3ccfe052dcf2457ec8949f389305ed.png"},5464:function(t,e,n){e.Z=n.p+"assets/images/gosingle_buildpacks_512-a7dd007fa298a266bf5ca2eb6dd73cb9.png"},3679:function(t,e,n){e.Z=n.p+"assets/images/gosingle_info_4096-59d952a3af1f853f7175df537fd8ea0e.png"},2724:function(t,e,n){e.Z=n.p+"assets/images/gosingle_security_groups_256-36efd6086f9ac5f30227ea4379020749.png"},4076:function(t,e,n){e.Z=n.p+"assets/images/gosingle_security_groups_512-61ba28ad2f2336bbab58b49a48de5cfe.png"},9498:function(t,e,n){e.Z=n.p+"assets/images/ng_buildpacks_32-59c3bf3cf83238ee7b93594d75a5c19f.png"},8506:function(t,e,n){e.Z=n.p+"assets/images/ng_buildpacks_64-a017e3b633c46f81f4270bb347a42b23.png"},9174:function(t,e,n){e.Z=n.p+"assets/images/ng_info_128-d8b8310719a1e4fae2a474d3d7827724.png"},2062:function(t,e,n){e.Z=n.p+"assets/images/ng_security_groups_64-9ac4ba31fd10c490da5eaafbb965f1e1.png"}}]);